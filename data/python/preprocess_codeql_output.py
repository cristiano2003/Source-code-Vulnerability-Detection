import csv
import os

def extract_specific_columns(file_path, columns):
    with open(file_path, newline='') as csvfile:
        csv_reader = csv.reader(csvfile)
        extracted_data = []
        for row in csv_reader:
            selected_columns = [row[i] for i in columns]
            if selected_columns[1] == 'error':
                extracted_data.append(selected_columns)
    return extracted_data

def process_folders(base_path, num_folders, columns_to_extract, output_file):
    all_extracted_data = []

    for i in range(1, num_folders + 1):
        folder_path = os.path.join(base_path, f'folder_{i}')
        file_path = os.path.join(folder_path, 'scan.csv')
        
        if os.path.exists(file_path):
            extracted_data = extract_specific_columns(file_path, columns_to_extract)
            all_extracted_data.extend(extracted_data)
        else:
            print(f"File {file_path} not found.")

    with open(output_file, 'w', newline='') as csvfile:
        csv_writer = csv.writer(csvfile)
        for data in all_extracted_data:
            csv_writer.writerow(data)

# Example usage
base_path = '/home/dhtuan/codeql-output'
num_folders = 100
columns_to_extract = [0, 2, 4, 5]
output_file = '/home/dhtuan/codeql-output/combined_extracted_data.csv'

process_folders(base_path, num_folders, columns_to_extract, output_file)